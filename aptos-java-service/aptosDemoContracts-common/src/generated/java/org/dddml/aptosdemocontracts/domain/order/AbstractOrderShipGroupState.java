// <autogenerated>
//   This file was generated by dddappp code generator.
//   Any changes made to this file manually will be lost next time the file is regenerated.
// </autogenerated>

package org.dddml.aptosdemocontracts.domain.order;

import java.util.*;
import java.math.*;
import java.util.Date;
import org.dddml.aptosdemocontracts.domain.*;
import org.dddml.aptosdemocontracts.specialization.*;
import org.dddml.aptosdemocontracts.domain.order.OrderShipGroupEvent.*;

public abstract class AbstractOrderShipGroupState implements OrderShipGroupState.SqlOrderShipGroupState, Saveable {

    private OrderShipGroupId orderShipGroupId = new OrderShipGroupId();

    public OrderShipGroupId getOrderShipGroupId() {
        return this.orderShipGroupId;
    }

    public void setOrderShipGroupId(OrderShipGroupId orderShipGroupId) {
        this.orderShipGroupId = orderShipGroupId;
    }

    private transient OrderState orderState;

    public OrderState getOrderState() {
        return orderState;
    }

    public void setOrderState(OrderState s) {
        orderState = s;
    }
    
    private OrderState protectedOrderState;

    protected OrderState getProtectedOrderState() {
        return protectedOrderState;
    }

    protected void setProtectedOrderState(OrderState protectedOrderState) {
        this.protectedOrderState = protectedOrderState;
    }

    public String getOrderId() {
        return this.getOrderShipGroupId().getOrderId();
    }
        
    public void setOrderId(String orderId) {
        this.getOrderShipGroupId().setOrderId(orderId);
    }

    public Integer getShipGroupSeqId() {
        return this.getOrderShipGroupId().getShipGroupSeqId();
    }
        
    public void setShipGroupSeqId(Integer shipGroupSeqId) {
        this.getOrderShipGroupId().setShipGroupSeqId(shipGroupSeqId);
    }

    private String shipmentMethod;

    public String getShipmentMethod() {
        return this.shipmentMethod;
    }

    public void setShipmentMethod(String shipmentMethod) {
        this.shipmentMethod = shipmentMethod;
    }

    private Long offChainVersion;

    public Long getOffChainVersion() {
        return this.offChainVersion;
    }

    public void setOffChainVersion(Long offChainVersion) {
        this.offChainVersion = offChainVersion;
    }

    private String createdBy;

    public String getCreatedBy() {
        return this.createdBy;
    }

    public void setCreatedBy(String createdBy) {
        this.createdBy = createdBy;
    }

    private Date createdAt;

    public Date getCreatedAt() {
        return this.createdAt;
    }

    public void setCreatedAt(Date createdAt) {
        this.createdAt = createdAt;
    }

    private String updatedBy;

    public String getUpdatedBy() {
        return this.updatedBy;
    }

    public void setUpdatedBy(String updatedBy) {
        this.updatedBy = updatedBy;
    }

    private Date updatedAt;

    public Date getUpdatedAt() {
        return this.updatedAt;
    }

    public void setUpdatedAt(Date updatedAt) {
        this.updatedAt = updatedAt;
    }

    private Boolean active;

    public Boolean getActive() {
        return this.active;
    }

    public void setActive(Boolean active) {
        this.active = active;
    }

    private Boolean deleted;

    public Boolean getDeleted() {
        return this.deleted;
    }

    public void setDeleted(Boolean deleted) {
        this.deleted = deleted;
    }

    public boolean isStateUnsaved() {
        return this.getOffChainVersion() == null;
    }

    private Set<OrderItemShipGroupAssociationState> protectedOrderItemShipGroupAssociations = new HashSet<>();

    protected Set<OrderItemShipGroupAssociationState> getProtectedOrderItemShipGroupAssociations() {
        return this.protectedOrderItemShipGroupAssociations;
    }

    protected void setProtectedOrderItemShipGroupAssociations(Set<OrderItemShipGroupAssociationState> protectedOrderItemShipGroupAssociations) {
        this.protectedOrderItemShipGroupAssociations = protectedOrderItemShipGroupAssociations;
    }

    private EntityStateCollection<String, OrderItemShipGroupAssociationState> orderItemShipGroupAssociations;

    public EntityStateCollection<String, OrderItemShipGroupAssociationState> getOrderItemShipGroupAssociations() {
        return this.orderItemShipGroupAssociations;
    }

    public void setOrderItemShipGroupAssociations(EntityStateCollection<String, OrderItemShipGroupAssociationState> orderItemShipGroupAssociations) {
        this.orderItemShipGroupAssociations = orderItemShipGroupAssociations;
    }

    private Boolean stateReadOnly;

    public Boolean getStateReadOnly() { return this.stateReadOnly; }

    public void setStateReadOnly(Boolean readOnly) { this.stateReadOnly = readOnly; }

    private boolean forReapplying;

    public boolean getForReapplying() {
        return forReapplying;
    }

    public void setForReapplying(boolean forReapplying) {
        this.forReapplying = forReapplying;
    }


    public AbstractOrderShipGroupState() {
        initializeProperties();
    }

    protected void initializeForReapplying() {
        this.forReapplying = true;

        initializeProperties();
    }
    
    protected void initializeProperties() {
        orderItemShipGroupAssociations = new SimpleOrderItemShipGroupAssociationStateCollection();
    }

    @Override
    public int hashCode() {
        return getShipGroupSeqId().hashCode();
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) { return true; }
        if (obj instanceof OrderShipGroupState) {
            return Objects.equals(this.getShipGroupSeqId(), ((OrderShipGroupState)obj).getShipGroupSeqId());
        }
        return false;
    }


    public void mutate(Event e) {
        setStateReadOnly(false);
        if (false) { 
            ;
        } else {
            throw new UnsupportedOperationException(String.format("Unsupported event type: %1$s", e.getClass().getName()));
        }
    }

    protected void merge(OrderShipGroupState s) {
        if (s == this) {
            return;
        }
        this.setShipmentMethod(s.getShipmentMethod());
        this.setActive(s.getActive());

        if (s.getOrderItemShipGroupAssociations() != null) {
            Iterable<OrderItemShipGroupAssociationState> iterable;
            if (s.getOrderItemShipGroupAssociations().isLazy()) {
                iterable = s.getOrderItemShipGroupAssociations().getLoadedStates();
            } else {
                iterable = s.getOrderItemShipGroupAssociations();
            }
            if (iterable != null) {
                for (OrderItemShipGroupAssociationState ss : iterable) {
                    OrderItemShipGroupAssociationState thisInnerState = ((EntityStateCollection.ModifiableEntityStateCollection<String, OrderItemShipGroupAssociationState>)this.getOrderItemShipGroupAssociations()).getOrAdd(ss.getProductId());
                    ((AbstractOrderItemShipGroupAssociationState) thisInnerState).merge(ss);
                }
            }
        }
        if (s.getOrderItemShipGroupAssociations() != null) {
            if (s.getOrderItemShipGroupAssociations() instanceof EntityStateCollection.ModifiableEntityStateCollection) {
                if (((EntityStateCollection.ModifiableEntityStateCollection)s.getOrderItemShipGroupAssociations()).getRemovedStates() != null) {
                    for (OrderItemShipGroupAssociationState ss : ((EntityStateCollection.ModifiableEntityStateCollection<String, OrderItemShipGroupAssociationState>)s.getOrderItemShipGroupAssociations()).getRemovedStates()) {
                        OrderItemShipGroupAssociationState thisInnerState = ((EntityStateCollection.ModifiableEntityStateCollection<String, OrderItemShipGroupAssociationState>)this.getOrderItemShipGroupAssociations()).getOrAdd(ss.getProductId());
                        this.getOrderItemShipGroupAssociations().remove(thisInnerState);
                    }
                }
            } else {
                if (s.getOrderItemShipGroupAssociations().isAllLoaded()) {
                    Set<String> removedStateIds = new HashSet<>(this.getOrderItemShipGroupAssociations().stream().map(i -> i.getProductId()).collect(java.util.stream.Collectors.toList()));
                    s.getOrderItemShipGroupAssociations().forEach(i -> removedStateIds.remove(i.getProductId()));
                    for (String i : removedStateIds) {
                        OrderItemShipGroupAssociationState thisInnerState = ((EntityStateCollection.ModifiableEntityStateCollection<String, OrderItemShipGroupAssociationState>)this.getOrderItemShipGroupAssociations()).getOrAdd(i);
                        this.getOrderItemShipGroupAssociations().remove(thisInnerState);
                    }
                }
            }
        }
    }

    public void save() {
        if (orderItemShipGroupAssociations instanceof Saveable) {
            ((Saveable)orderItemShipGroupAssociations).save();
        }
    }

    protected void throwOnWrongEvent(OrderShipGroupEvent event) {
        String stateEntityIdOrderId = this.getOrderShipGroupId().getOrderId();
        String eventEntityIdOrderId = ((OrderShipGroupEvent.SqlOrderShipGroupEvent)event).getOrderShipGroupEventId().getOrderId();
        if (!stateEntityIdOrderId.equals(eventEntityIdOrderId)) {
            throw DomainError.named("mutateWrongEntity", "Entity Id OrderId %1$s in state but entity id OrderId %2$s in event", stateEntityIdOrderId, eventEntityIdOrderId);
        }

        Integer stateEntityIdShipGroupSeqId = this.getOrderShipGroupId().getShipGroupSeqId();
        Integer eventEntityIdShipGroupSeqId = ((OrderShipGroupEvent.SqlOrderShipGroupEvent)event).getOrderShipGroupEventId().getShipGroupSeqId();
        if (!stateEntityIdShipGroupSeqId.equals(eventEntityIdShipGroupSeqId)) {
            throw DomainError.named("mutateWrongEntity", "Entity Id ShipGroupSeqId %1$s in state but entity id ShipGroupSeqId %2$s in event", stateEntityIdShipGroupSeqId, eventEntityIdShipGroupSeqId);
        }


        if (getForReapplying()) { return; }

    }


    public static class SimpleOrderShipGroupState extends AbstractOrderShipGroupState {

        public SimpleOrderShipGroupState() {
        }

        public static SimpleOrderShipGroupState newForReapplying() {
            SimpleOrderShipGroupState s = new SimpleOrderShipGroupState();
            s.initializeForReapplying();
            return s;
        }

    }


    class SimpleOrderItemShipGroupAssociationStateCollection implements EntityStateCollection.ModifiableEntityStateCollection<String, OrderItemShipGroupAssociationState> {

        @Override
        public OrderItemShipGroupAssociationState get(String productId) {
            return protectedOrderItemShipGroupAssociations.stream().filter(
                            e -> e.getProductId().equals(productId))
                    .findFirst().orElse(null);
        }

        @Override
        public boolean isLazy() {
            return false;
        }

        @Override
        public boolean isAllLoaded() {
            return true;
        }

        @Override
        public Collection<OrderItemShipGroupAssociationState> getLoadedStates() {
            return protectedOrderItemShipGroupAssociations;
        }

        @Override
        public Collection<OrderItemShipGroupAssociationState> getRemovedStates() {
            return null;
        }

        @Override
        public OrderItemShipGroupAssociationState getOrAdd(String productId) {
            OrderItemShipGroupAssociationState s = get(productId);
            if (s == null) {
                OrderItemShipGroupAssociationId globalId = new OrderItemShipGroupAssociationId(getOrderShipGroupId().getOrderId(), getOrderShipGroupId().getShipGroupSeqId(), productId);
                AbstractOrderItemShipGroupAssociationState state = new AbstractOrderItemShipGroupAssociationState.SimpleOrderItemShipGroupAssociationState();
                state.setOrderItemShipGroupAssociationId(globalId);
                add(state);
                s = state;
            }
            return s;
        }

        @Override
        public int size() {
            return protectedOrderItemShipGroupAssociations.size();
        }

        @Override
        public boolean isEmpty() {
            return protectedOrderItemShipGroupAssociations.isEmpty();
        }

        @Override
        public boolean contains(Object o) {
            return protectedOrderItemShipGroupAssociations.contains(o);
        }

        @Override
        public Iterator<OrderItemShipGroupAssociationState> iterator() {
            return protectedOrderItemShipGroupAssociations.iterator();
        }

        @Override
        public Object[] toArray() {
            return protectedOrderItemShipGroupAssociations.toArray();
        }

        @Override
        public <T> T[] toArray(T[] a) {
            return protectedOrderItemShipGroupAssociations.toArray(a);
        }

        @Override
        public boolean add(OrderItemShipGroupAssociationState s) {
            if (s instanceof AbstractOrderItemShipGroupAssociationState) {
                AbstractOrderItemShipGroupAssociationState state = (AbstractOrderItemShipGroupAssociationState) s;
                state.setProtectedOrderShipGroupState(AbstractOrderShipGroupState.this);
            }
            return protectedOrderItemShipGroupAssociations.add(s);
        }

        @Override
        public boolean remove(Object o) {
            if (o instanceof AbstractOrderItemShipGroupAssociationState) {
                AbstractOrderItemShipGroupAssociationState s = (AbstractOrderItemShipGroupAssociationState) o;
                s.setProtectedOrderShipGroupState(null);
            }
            return protectedOrderItemShipGroupAssociations.remove(o);
        }

        @Override
        public boolean containsAll(Collection<?> c) {
            return protectedOrderItemShipGroupAssociations.contains(c);
        }

        @Override
        public boolean addAll(Collection<? extends OrderItemShipGroupAssociationState> c) {
            return protectedOrderItemShipGroupAssociations.addAll(c);
        }

        @Override
        public boolean removeAll(Collection<?> c) {
            return protectedOrderItemShipGroupAssociations.removeAll(c);
        }

        @Override
        public boolean retainAll(Collection<?> c) {
            return protectedOrderItemShipGroupAssociations.retainAll(c);
        }

        @Override
        public void clear() {
            protectedOrderItemShipGroupAssociations.clear();
        }
    }


}

