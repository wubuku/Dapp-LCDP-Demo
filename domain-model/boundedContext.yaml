#%DDDML 0.1
---

configuration:

  boundedContextName: "Dddml.SuiDemoContracts"
  
  defaultModule: 
    name: "Dddml.SuiDemoContracts"
  
  isSurrogateIdMandatory: true
  defaultSurrogateId:
    name: Id
    type: UID
  aggregateEventVersionProperty:
    name: Version
    type: u64
  mandatoryAggregateImplements: ["VersionedSuiMoveObject"]
  mandatoryAggregateEventImplements: ["SuiEventEnvelope", "SuiMoveEvent", "HasStatus"]
  # "VersionedSuiMoveEvent", "HasSuiEventNextCursor"

  #genericTypes: ["TAccountId", "TQuantity"]
  isGenericTypeAsType: true
  baseUri: "/api"
  
  databaseNamingConvention: "UnderscoredNamingConvention"
  #associationMappingsEnabled: true
  
  valueObjectBaseTypes:
    "Email": "string"
    
  #defaultTimestampType: "Timestamp"

  defaultReservedProperties:
    active: Active
    createdBy: CreatedBy
    createdAt: CreatedAt
    updatedBy: UpdatedBy
    updatedAt: UpdatedAt
    deleted: Deleted
    version: OffChainVersion
    
  sqlTypes:
    DateTime: DATETIME
    decimal: decimal(18,6)
    decimal?: decimal(18,6)
  
  # -----------------------------------------
  accountingQuantityTypes:
    decimal:
      zeroLogic:
        Java: "BigDecimal.ZERO"
      addLogic:
        Java: "{fst}.add({snd} != null ? {snd} : BigDecimal.ZERO)"
      negateLogic:
        Java: "{0}.negate()"
        
  # -----------------------------------------
  namedStringPatterns:
    "AttributeId": "^[\\(A-Za-z0-9][A-Za-z0-9]*"
    
  onCommandExecuting:
    Java: "{0}.setRequesterId(SecurityContextUtil.getRequesterId());"
  
  metadata:
    
    HttpServicesAuthorizationEnabled: false
    #AutoAggregateMethodJavaDefautLogicEnabled: true
    #AlwaysGeneratingClobEventProperties: true
    
    HttpPostCreationWithIdEnabled: true
    HttpPutToMergePatchEnabled: true
    
    MvoUsingRViewAsMView: true
    #MvoStateDatabaseTableNameFormat: "{0}s"
    #MvoHttpServiceResourceCollectionNameFormat: "{0}s"
    #MvoClrAggregateDomainSubNamespaceName: "MViews"
    #MvoJavaAggregateDomainSubPackageName: "mviews"
    
    SpringSecurityEnabled: true
    
    ClrDomainServiceSubNamespaceName: "Services"
    ClrHttpServiceSetRequesterIdAttributeEnabled: true
    ClrHttpServiceJsonContractResolver: "Newtonsoft.Json.Serialization.CamelCasePropertyNamesContractResolver"
    ClrHttpServiceJsonConverters: [
        "Dddml.SuiDemoContracts.HttpServices.JsonConverters.LongConverter",
        "Dddml.SuiDemoContracts.HttpServices.JsonConverters.DecimalConverter"]
    ClrHttpServiceDtoJObjectMapperAssembly: "Dddml.SuiDemoContracts.HttpServices"

    ClrRamlVersion: "0.8"
    ClrRamlClientSubNamespace: "HttpServices.ClientProxies.Raml"
    ClrRamlClientMainClassName: "DddmlSuiDemoContractsRamlClient"

    TypeScriptJsonUsingCamelCasePropertyName: true
    
    NoStateToCommandConverters: true

    IgnoringRemovementConcurrencyConflict: true
    
    # --------------------------------------------------------------
    # Enable Message-based Commands for all Internal Methods
    InternalMethodMessagingCommandEnabled: true

    # --------------------------------------------------------------
    AutoAggregateMethodJavaDefaultLogicEnabled: true
    AutoGeneratingCrUDCommandsDisabled: true
    # OptimisticLockingVersionDisabled: true
    # JavaSuiContractPackage: "com.github.wubuku.sui.tests"

  sui:
    boundedContextPackage: "sui_contracts"
    moveObjectVersionPropertyName: "Version"
    moveObjectVersionPropertyType: "u64"
    # ignoredMandatoryAggregateEventImplements: ...
    offChainObjectNames: ["SuiEventId"]

    typeMappings:
      "U8": "u8"
      "U16": "u16"
      "U32": "u32"
      "U64": "u64"
      "U128": "u128"
      "vector<u8>": "vector<u8>"
      "string": "String" # std::string::String
      "String": "String"
      "Boolean": "bool"
      "Bool": "bool"

    typeModules:
      "string": "std::string"
      "String": "std::string"
    
  java:
  
    boundedContextPackage: "org.dddml.suidemocontracts"
    specializationPackage: "org.dddml.suidemocontracts.specialization"
    isUsingSeparatedDomainAggregatePackage: true
    defaultUserIdType: "string"
    #JavaSerializationAnnotationTypes: {}
    eventLobPropertiesName: "DynamicProperties"
    eventLobPropertiesPersistenceName: "DynamicPropertiesLob"
    eventLobPropertiesSqlType: VARCHAR(2000)
    
    typeMappings: 
      "bool": "Boolean"
      "bool?": "Boolean"
      "DateTime": "Date"
      "DateTime?": "Date"
      "decimal": "BigDecimal"
      "decimal?": "BigDecimal"
      "int": "Integer"
      "int?": "Integer"
      "long": "Long"
      "long?": "Long"
      "string": "String"
      "String": "String"
      #"Timestamp": "Timestamp"
      "U8": "Integer"
      "U16": "Integer"
      "U32": "Long"
      "U64": "BigInteger"
      "U128": "BigInteger"
      "vector<u8>": "int[]"
      "u8": "Integer"
      "u16": "Integer"
      "u32": "Long"
      "u64": "BigInteger"
      "u128": "BigInteger"
      #"UID": "String"

    typePackages:
      "BigDecimal": "java.math"
      "BigInteger": "java.math"
      "Date": "java.util"
      "Money": "org.joda.money"
      #"Timestamp": "java.sql"

  # -----------------------------------------
  onRestfulCommandExecuting:
    Java: "{0}.setRequesterId(SecurityContextUtil.getRequesterId());"
  #onRestfulCommandExecuting:
  #  Java: "SecurityContextUtil.setCommandContext({0});"      
      
  php:
  
    boundedContextNamespace: "Dddml\\SuiDemoContracts"
    specializationNamespace: "Dddml"
    defaultUserIdType: "string"
    isUsingSeparatedDomainAggregateNamespace: false
    
    typeMappings:
      "bool": "boolean"
      "bool?": "boolean"
      "DateTime": "\\DateTime"
      "DateTime?": "\\DateTime"
      "decimal": "Decimal"
      "decimal?": "Decimal"
      "int": "integer"
      "int?": "integer"
      "long": "Long"
      "long?": "Long"
      "Money": "Money"
      "string": "string"
    
    serializationAnnotationTypes:
      "bool": "boolean"
      "bool?": "boolean"
      "int": "integer"
      "int?": "integer"
      "string": "string"
      "decimal": "Dddml\\Serializer\\Type\\Decimal"
      "decimal?": "Dddml\\Serializer\\Type\\Decimal"
      "long": "Dddml\\Serializer\\Type\\Long"
      "long?": "Dddml\\Serializer\\Type\\Long"
      "Money": "Dddml\\Serializer\\Type\\Money"
      "DateTime": "DateTime"
      "DateTime?": "DateTime"
      
    #typeNamespaces:
    #  "Money": "NodaMoney"
      
    defaultFieldTypes:
      "bool": "CheckboxType"
      "bool?": "CheckboxType"
      "DateTime": "DateTimeType"
      "DateTime?": "DateTimeType"
      "decimal": "NumberType"
      "decimal?": "NumberType"
      "int": "IntegerType"
      "int?": "IntegerType"
      "long": "IntegerType"
      "long?": "IntegerType"
      "string": "TextType"
      "Money": "MoneyType"
        
  typeScript:
  
    boundedContextNamespace: "Dddml.SuiDemoContracts"
    specializationNamespace: "Dddml"
    isUsingSeparatedDomainAggregateNamespace: false
    
    typeNamespaces:
      "Money": "NodaMoney"
  
    typeMappings:
      "bool": "boolean"
      "bool?": "boolean"
      "DateTime": "string"
      "DateTime?": "string"
      "decimal": "string"
      "decimal?": "string"
      "int": "number"
      "int?": "number"
      "float": "number"
      "double": "number"
      "long": "string"
      "long?": "string"
      "Money": "Money"
      "string": "string"
            
  hibernate:
  
    hibernateTypes:
      Money:
        mappingType: "org.dddml.suidemocontracts.domain.hibernate.usertypes.MoneyType"
        propertyNames: ["Amount", "Currency"] 
        propertyTypes: ["decimal", "string"]
      DateTime:
        mappingType: timestamp
        
  nHibernate:
    
    timestampMappingType: DateTimeUtc
    nHibernateTypes:
      Money:
        mappingType: "Dddml.SuiDemoContracts.Services.Domain.NHibernate.NodaMoneyType, Dddml.SuiDemoContracts.Services"
        propertyNames: ["Amount", "Currency"]
        propertyTypes: ["decimal", "string"]

  aggregates:
  
    AttributeSetInstance:
      metadata:
        PersistingStateEventRemovedPropertiesAsSet: true
        CreationWithoutIdEnabled: true
        HttpPostCreationEnabled: true
        GeneratingAbstractIdGenerator: true

